**구글과 쇼단을 적극 활용하자!**

## **진단 항목**

- OWASP TOP 10, OWASP Moible TOP 10에서 지정한 취약점과 공격 트렌트를 반영한 25개의 항목으로 진단합니다.
- (※ 위험도의 경우 서비스의 중요도 및 취약점의 영향도를 파악하여 컨설턴트가 판단하여 산정합니다.)



## 단순 정보 노출

### 불필요 파일/페이지 노출

- `불필요 파일/페이지 노출` 이란 말 그대로 웹 사이트의 민감한 정보가 노출되는 것으로 개발 과정의 코멘트 (소스 내 주석) 또는 에러 메시지 등에서 의도하지 않은 정보가 노출되는 취약점을 의미한다.

**판단기준**

1. 에러 페이지에 웹 서버 및 WAS 버전정보, 절대경로, 에러메시지가 노출
2. 소스코드 내에 주석 형태로 남아있는 테스트용 아이디/패스워드, 관리자 페이지 URL 정보가 존재하는 경우
3. HTTP 헤더를 통한 서버정보 노출

![image](https://user-images.githubusercontent.com/33051018/73243516-198ccf80-41eb-11ea-8681-d1cff7a2fbf1.png)

4. 탐색기(윈도우즈 ) 또는 명령어(*nix)를 통해 서비스중인 웹 디렉터리 상에서 .bak, .old, .txt, .zip, .log 등의 확장자를 가진 파일이 존재하는지 확인한다.

   파일이 존재할 경우 해당 URL을 입력하였을 때 소스코드가 노출되는지 확인한다.



### 부적절한 로그인 실패 메시지

- 부적절한 예외 처리와 같은 맥락으로써, 프로그램 설계시 예외상황에 대한 로직이 탄탄히 설계되지 않으면, 예외상황 발생시 보안상 문제가 발생할 수 있다. 

웹서버가 사용자 요청을 처리하는 과정에서 오류 또는 예외가 발생할 경우 웹 브라우저상에 오류 내용에 대하여 설명을 해주는 메시지들을 출력해 주는데, 때로는 이 메시지에 포함된 정보들이 공격에 기초정보로 활용될 수 있다.

따라서, 403, 404, 500 등의 HTTP 오류가 발생할 때, 별도로 제작한 페이지 또는 메시지를 출력하도록 조치한다.



### 에러 메시지 노출

- 개발자가 생성한 오류 메시지에 시스템 내부 구조 또는 계정 벙보 등이 포함되어 민감한 정보가 노출될 수 있는 보안약점이다.
- 시스템이나 애플리케이션에 대한 상세한 주요 정보가 노출될 수 있다.

**주요 노출 정보**

- `SQL Injejction` 정보 제공
- 경로 제공
- 서버 버전 제공

```java
try {
    ....
	}
    catch (Exception e) {
        e.printStackTrace();
        	return e.getMessage();
}
```

`printStackTrace` 사용시, 오류 메세지가 공격자에게 노출될 수 있다.

```java
try {
    ....
	}
	catch (Exception e) {
        System.out.printlen("Error 1");
        	return "Error 1";
}
```

에러 내용이 아닌 에러 코드를 표시함으로써 공격자에게 중요한 내용이 노출되지 않도록 한다.



---

## 중요 정보 노출

### 중요정보 평문 전송

- 사용자 또는 시스템의 주요정보가 포함된 데이터를 평문으로 송수신할 경우, 통신채널 스니핑을 통해 인가되지 않은 사용자에게 민감한 데이터가 노출될 수 있는 보안 약점

**점검방법**

웹 통신을 확인할 수 있는 와이어샤크, 피들러와 같은 도구를 이용해 서버와 인증시 전달되는 정ㅇ보가 평문으로 전송되는지 확인해 보아야 한다.



### 파일 업로드

- 웹 사이트의 게시판, 자료실 등에 조작된 Server Side Script 파일 업로드 및 실행 가능 여부 점검

**점검 방법**

파일 업로드가 가능한 경우, Server side script 파일을 업로드하고 해당 파일이 업로드 된 주소를 파일 우클릭을 통해 확인 후 url을 통해 접근해본다.

업로드 되는 파일에 대한 확장자 검증이 이루어지지 않는 경우 취약

-> 업로드 되는 파일에 대한 확장자 검증 & 실행 권한 제거



### 파일 다운로드

- 홈페이지 상에서 파일을 다운받는 cgi, jsp, asp, php, php3 등의 프로그램에서 입력되는 경로를 체크하지 않는 경우 임의의 문자 (../../ 등)나 주요 파일명의 입력을 통해 웹 서버의 홈 디렉터리를 벗어나서 임의의 위치에 있는 파일을 열람하거나 다운받는 것이 가능한 취약점.

**점검방법**

1) 게시판 또는 공지사항, 자료실 등에서 cgi, jsp, php등과 같은 프로그램을 이용하여 파일을 다운로드 받는 페이지가 있는지 확인.

2) 다음과 같이 파일 다운로드 시도

`../../../../etc/passwd` , `../../../../winnt/win.ini`, `../../../../boot.ini` 등 사용하는 웹 서비스 엔진에 따라 차이 존재.

3) 아래와 같이 인코딩을 적용하여 해당 파일 내용이 표시되는지 확인한다.
URL 인코딩 .(%2e), /(%2f), \(%5c)16bit 유니코드인코딩 .(%u002e), /(%u2215), \(%u2216)더블URL 인코딩 .(%252e), /(%252f), \(%255c)

4) null 바이트 인젝션 시도정상적인 파일에 널바이트 또는 개행문자를 삽입하여 어떤 필터링이 사용되는지 파악 할 수 있다. 이 방법은 php 환경이나 java, c/c++ 환경에서 적용된다. 또한 리눅스에서는 NULL이 문자열의 끝을 의미하지만 윈도우는 그렇지 않다. 따라서 윈도우 서버에서는 통하지 않는다.)- normal.jpg.jpg 을 테스트 시도- index/../normal.jpg 와 같이 경로 파악 시도- ../../../../etc/passwd NULL.jpg 등을 통해 시스템 파일 다운로드 시도- ../../../usr/...log/ 을 통해 로그파일 다운로드

** %0a 는 lindfeed 즉 개행이다.

유닉스의 경우, 

5) 특정 디렉터리나 파일을 먼저 입력한 후 탐색 문자열을 입력할 수도 있다./was/tomcat/image/../../../../etc/passwd

https://xn--ex3bt1ov9l.kr/354



### 디렉터리 리스팅

- 구글을 통해 취약점 진단 가능. 
- **Site:[domain]** -> 특정 사이트 내에서만 검색 가능. **intitile: "index of"**-> 가장 흔한 디렉토리 리스팅 취약점 진단방법으로 취약점 이 존재하는 사이트가 검색된다.
- 





---

## 원격 명령실행



### SQL Injection

- 검증되지 않은 외부 입력값이 SQL쿼리문 생성에 사용되어 악의적인 쿼리가 실행될 수 있는 보안 약점.
- 조작된 쿼리를 통해 DB 정보가 노출되거나 변조, 불법 로그인의 위험이 있다.

#### 예제 코드

```java
try {
    String tableName = props.getProperty("jdbc.tableName");
    String name = props.getProperty("jdbc.name");
    String query = "SELECT * FROM " + tableName + " WHERE Name =" + name;
    stmt = con.createStatement(query);
    result = stmt.executeQuery();
    ...
} catch (SQLException sqle) {...} finally {...}
```

외부 입력값으로 초기화되는 변수 `tableName` 과 `name`이 SQL쿼리문에 필터링없이 바로 사용되어진다.

#### 잘못된 조치방법

```java
String tableName = props.getProperty("jdbc.tableName");
String name = props.getProperty("jdbc.name");
String query = "SELECT * FROM " + tableName + " WHERE Name =" + name;
stmt = con.prepareStatement(query);
result = stmt.executeQeury();
...
```

`Line 4`를 살펴보면 `createStatement`가 아닌 `prepareStatement`를 사용하였으나, `setString`등의 상수 스트링을 이용하여 쿼리문의 구조 변경이 가능하다. 



#### 안전한 소스코드

```java
String tableName = props.getProperty("jdbc.tableName");
String anme = props.getProperty("jdbc.name");
String query = "SELECT * FROM ? WHERE Name = ?";
stmt = con.prepareStatement(query);
stmt.setString(1, tableName); stmt.setString(2, name);
result = stmt.executeQuery();
...
```

`setString`등의 상수 스트링을 이용하여 쿼리문 구조가 변경되지 않는 `preparedStatement` 클래스를 이용한다.

`query` 내용중 `?`로 기재된 곳에 `set`계열 메서드들을 통해 값을 전달할 수 있다.

따라서, 최종적으로 실행되는 쿼리는 `SELECT * FROM tableName WHERE Name = name`이다.

`cf) SQL 인젝션 취약점 제거를 위해 입력 필터링이 요구되는 특수문자 : ' " # - ( ) ; @ = * / + `